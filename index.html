<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="ch">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="../../../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="../../../../css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="../../../../images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="../../../../images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="../../../../images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="../../../../images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="高宽的小站">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="高宽的小站">
<meta property="og:locale" content="ch">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="高宽的小站">






  <link rel="canonical" href="http://yoursite.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>高宽的小站</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="ch">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">高宽的小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">记录</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com2019/01/15/2019-1-17/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="高宽">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高宽的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="2019/01/15/2019-1-17/" class="post-title-link" itemprop="url">2019-1-17</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-15 10:54:46 / Modified: 11:33:59" itemprop="dateCreated datePublished" datetime="2019-01-15T10:54:46+00:00">2019-01-15</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <img src="/2019/01/15/2019-1-17/1236).jpeg" width="123">
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com2019/01/15/2019-1-15/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="高宽">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高宽的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="2019/01/15/2019-1-15/" class="post-title-link" itemprop="url">hexo配置与相关语法</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-15 00:00:00 / Modified: 11:33:59" itemprop="dateCreated datePublished" datetime="2019-01-15T00:00:00+00:00">2019-01-15</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com2019/01/14/2019-1-14/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="高宽">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高宽的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="2019/01/14/2019-1-14/" class="post-title-link" itemprop="url">react 使用 mobx 实现无刷新切换语言</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-01-14 16:22:27" itemprop="dateCreated datePublished" datetime="2019-01-14T16:22:27+00:00">2019-01-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-15 11:33:59" itemprop="dateModified" datetime="2019-01-15T11:33:59+00:00">2019-01-15</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>项目需要中英双语, 第一个版本通过加载页面时识别语言设置, 来加载对应语言数据. 切换语言时, 需要先设置语言, 然后重载页面. 后来引入 <a href="https://cn.mobx.js.org/" target="_blank" rel="noopener">mobx</a> 状态管理后, 利用响应式的思维, 实现了点击切换语言时, 自动的更新ui, 而无需刷新页面.</p>
<p><strong>要点与实现</strong></p>
<ol>
<li>创建可观察数据<em>语言</em>, 并实现相应<em>actions</em></li>
<li>在语言配置中引入上述语言配置, 并导出响应式结果(函数)</li>
<li>组件使用mobx包装, 并使用上述语言配置</li>
</ol>
<h2 id="关键代码"><a href="#关键代码" class="headerlink" title="关键代码"></a>关键代码</h2><ol>
<li>定义状态和动作</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LanguageStore</span> </span>&#123;</span><br><span class="line">    @observable lang = <span class="string">'ch'</span></span><br><span class="line"></span><br><span class="line">    @action.bound setLang(lang = <span class="string">'ch'</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.lang = lang</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>语言配置</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">"mobx"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这里语言使用了 &#123;英文: 中文&#125; 的数据格式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> langStore <span class="keyword">from</span> <span class="string">'../../store/languageStore'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> HOME_LANG <span class="keyword">from</span> <span class="string">'./lang.home'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Language</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    _getLangFunction(langOption) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> langStore.lang === <span class="string">'ch'</span> ? langOption[key] : key</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @computed get homeLang() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._getLangFunction(HOME_LANG)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ins = <span class="keyword">new</span> Language()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> homeLang = ins.homeLang</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方便导入 import &#123;homeLang&#125; from ...</span></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    homeLang,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ins</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>组件内使用</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">import</span> &#123;homeLang&#125; <span class="keyword">from</span> <span class="string">"common/language"</span></span><br><span class="line">@observer</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div className=<span class="string">"home"</span>&gt;</span><br><span class="line">                    &lt;div className=<span class="string">"title"</span>&gt;</span><br><span class="line">                        &#123;homeLang(<span class="string">"Title"</span>)&#125;</span><br><span class="line">                    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com2018/05/27/2018-5-27/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="高宽">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高宽的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="2018/05/27/2018-5-27/" class="post-title-link" itemprop="url">利用模板技术(pug), 搭建低复杂度/组件化的多页面应用</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-05-27 00:00:00" itemprop="dateCreated datePublished" datetime="2018-05-27T00:00:00+00:00">2018-05-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-15 11:33:59" itemprop="dateModified" datetime="2019-01-15T11:33:59+00:00">2019-01-15</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p><a href="https://github.com/roy-k/Mutipages" target="_blank" rel="noopener">本项目</a>是根据webpack多页面配置, 结合pug模板能力实现.</p>
</blockquote>
<blockquote>
<p>适合官网类, 偏静态, 含重复布局的项目. 无框架</p>
</blockquote>
<blockquote>
<p>涉及: pug模板语法, stylus(可选), es6+语法(可选)</p>
</blockquote>
<h2 id="实现概览图"><a href="#实现概览图" class="headerlink" title="实现概览图"></a>实现概览图</h2><h2 id="代码解析"><a href="#代码解析" class="headerlink" title="代码解析"></a>代码解析</h2><h3 id="目录介绍"><a href="#目录介绍" class="headerlink" title="目录介绍"></a>目录介绍</h3><ol>
<li><p>common 静态(公共)文件</p>
<ul>
<li>entry 入口目录, 根据 pages 子文件夹, 自动生成入口文件.</li>
</ul>
</li>
<li><p>pages 开发目录</p>
<ul>
<li><p>_chips 组件文件夹</p>
</li>
<li><p>文件夹名.pug 即该页面主体代码</p>
</li>
<li><p>css/js 独特样式/逻辑</p>
</li>
</ul>
</li>
<li><p>webpack 配置目录</p>
<ul>
<li><p>pages.js 读取目录, 生成配置</p>
</li>
<li><p>checkEntry.js 自动生成入口文件</p>
</li>
</ul>
</li>
</ol>
<h3 id="webpack-相关配置"><a href="#webpack-相关配置" class="headerlink" title="webpack 相关配置"></a>webpack 相关配置</h3><ol>
<li>pages 导出配置</li>
</ol>
<ol start="2">
<li><p>webpack配置关键点</p>
<ul>
<li><p>入口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123;</span><br><span class="line">    ...entrys,</span><br><span class="line">    vendor: [<span class="string">'jquery'</span>]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>html-webpack-plugin配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...htmlPluginArr.map(<span class="function">(<span class="params">&#123;filename, template, chunks&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HtmlWebpackPlugin(&#123;filename, template, chunks&#125;)</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h3 id="页面组织"><a href="#页面组织" class="headerlink" title="页面组织"></a>页面组织</h3><ol>
<li>_chips 文件夹放组件</li>
<li>pages/home/home.pug, 页面主体代码</li>
</ol>
<h2 id="issues"><a href="#issues" class="headerlink" title="issues"></a>issues</h2><ol>
<li>pug img src不支持问题</li>
</ol>
<p>使用require: img(src=require(‘../../common/images/xx.png’), alt=’’)</p>
<p>可结合webpack别名, cool</p>
<ol start="2">
<li>css热替换出错, 替换但未刷新 Nothing hot updated</li>
</ol>
<p>ExtractTextPlugin 的问题</p>
<p>开发环境关闭</p>
<p>正式环境启用 分离css文件</p>
<ol start="3">
<li><p>模板文件修改不自动刷新</p>
</li>
<li><p>未做模块分离等</p>
</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://array_huang.coding.me/webpack-book/" target="_blank" rel="noopener">多页为王：webpack多页应用架构专题系列</a></li>
<li><a href="https://pugjs.org/zh-cn/api/getting-started.html" target="_blank" rel="noopener">pug文档</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com2018/04/05/2018-4-5/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="高宽">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高宽的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="2018/04/05/2018-4-5/" class="post-title-link" itemprop="url">node 事件池 - macro micro tick Task</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-04-05 00:00:00" itemprop="dateCreated datePublished" datetime="2018-04-05T00:00:00+00:00">2018-04-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-15 11:33:59" itemprop="dateModified" datetime="2019-01-15T11:33:59+00:00">2019-01-15</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h1><h2 id="js-引擎模型"><a href="#js-引擎模型" class="headerlink" title="js 引擎模型"></a>js 引擎模型</h2><p>从宏观角度讲, js 的执行是单线程的. 所有的异步结果都是通过 “任务队列(Task Queue)” 来调度被调度. 消息队列中存放的是一个个的任务(Task). 规范中规定, Task 分为两大类, 分别是 Macro Task 和 Micro Task.</p>
<blockquote>
<p><strong>每个 Macro Task 结束后, 都要清空所有的 Micro Task</strong></p>
</blockquote>
<blockquote>
<p><strong>当这些 microtask 执行结束后还能继续添加 microtask 一直到真个 microtask 队列执行结束</strong></p>
</blockquote>
<h2 id="Task-分类"><a href="#Task-分类" class="headerlink" title="Task 分类"></a>Task 分类</h2><ol>
<li><p>Macrotask 包括:</p>
<ul>
<li>setImmediate</li>
<li>setTimeout</li>
<li>setInterval</li>
</ul>
</li>
<li>Microtask 包括:<ul>
<li>process.nextTick</li>
<li>Promise</li>
<li>Object.observe</li>
<li>MutaionObserver</li>
</ul>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">// 当这些 microtask 执行结束后还能继续添加 microtask 一直到真个 microtask 队列执行结束。</span></span><br><span class="line">    process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">7</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">8</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">6</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    resolve();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">4</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">process.nextTick(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>
<p>从微观实现的角度讲, 引擎都会有三个 Task Queue:</p>
<pre><code>- Tick Task Queue
- Micro Task Queue
- Macro Task Queue
</code></pre><blockquote>
<p>Tick 优先级高于 Micro</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com2018/03/21/2018-3-27/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="高宽">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高宽的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="2018/03/21/2018-3-27/" class="post-title-link" itemprop="url">纵观前端开发</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-03-21 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-21T00:00:00+00:00">2018-03-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-15 11:33:59" itemprop="dateModified" datetime="2019-01-15T11:33:59+00:00">2019-01-15</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>待录入</p>
<h2 id="browser"><a href="#browser" class="headerlink" title="browser"></a>browser</h2><ol>
<li><p>react线</p>
</li>
<li><p>vue线</p>
</li>
<li><p>webpack与构建</p>
</li>
</ol>
<h2 id="server"><a href="#server" class="headerlink" title="server"></a>server</h2><ol>
<li><p>koa(express)线</p>
</li>
<li><p>爬虫与函数库线</p>
</li>
</ol>
<h2 id="周边"><a href="#周边" class="headerlink" title="周边"></a>周边</h2><ol>
<li><p>linux与部署</p>
</li>
<li><p>sql与数据设计</p>
</li>
<li><p>浏览器扩展</p>
</li>
<li><p>测试与自动化</p>
</li>
<li><p>小程序相关</p>
</li>
</ol>
<h2 id="业务与能力实现"><a href="#业务与能力实现" class="headerlink" title="业务与能力实现"></a>业务与能力实现</h2><ol>
<li><p>展示型</p>
</li>
<li><p>简单数据通信</p>
</li>
<li><p>复杂数据通信</p>
</li>
<li><p>视频播放</p>
</li>
<li><p>app混合</p>
</li>
</ol>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ol>
<li><p>mac</p>
</li>
<li><p>windows</p>
</li>
<li><p>跨平台类</p>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com2018/03/21/2018-3-21/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="高宽">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高宽的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="2018/03/21/2018-3-21/" class="post-title-link" itemprop="url">webpack 入门姿势</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-03-21 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-21T00:00:00+00:00">2018-03-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-15 11:33:59" itemprop="dateModified" datetime="2019-01-15T11:33:59+00:00">2019-01-15</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="演变过程"><a href="#演变过程" class="headerlink" title="演变过程"></a>演变过程</h2><ol>
<li><p>输入输出</p>
<ul>
<li>管理资源:  各种loader</li>
<li>组织输出:<ul>
<li>html-webpack-plugin  更新引用</li>
<li>clean-webpack-plugin  清理dist文件夹</li>
<li>多出口名称格式化  [name].bundle.js</li>
</ul>
</li>
</ul>
</li>
<li><p>助力开发</p>
<ul>
<li><p>source map</p>
<p>  开发环境推荐：  cheap-module-eval-source-map<br>  生产环境推荐：  cheap-module-source-map</p>
</li>
<li><p>查看更新</p>
<p>  webpack’s Watch Mode        观察模式, 需要刷新浏览器</p>
<p>  webpack-dev-server  可以自动打开浏览器 / 热替换 / 自动刷新</p>
<p>  webpack-dev-middleware      一个容器(wrapper)，它可以把 webpack 处理后的文件传递给一个服务器(server)</p>
</li>
</ul>
</li>
</ol>
<ol start="3">
<li><p>模块热替换(只编译并替换变更的部分)</p>
<ul>
<li><p>命令后加 –hot</p>
</li>
<li><p>配置中启用热替换: dev-server: hot设为true, 并加入plugins</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Tree Shaking   移除无用代码  (4+  已集成)</p>
<p> uglifyjs-webpack-plugin 谨慎模式</p>
</li>
<li><p>配置分离</p>
</li>
</ol>
<p>取出公共配置, 通过webpack-merge或手动合并独立配置</p>
<ol start="6">
<li><p>代码分离</p>
<ul>
<li><p>分离css</p>
<p>  ExtractTextPlugin 分离出单独的文件</p>
</li>
<li><p>入口分离  使用 entry 手动分离</p>
<p>  会重复引用模块 / 不灵活 / 不能动态拆分</p>
</li>
</ul>
</li>
</ol>
<pre><code>- 防止重复  使用 commonsChunkPlugin 去重和分离chunk (4+ 已移除)

    改成使用optimization.splitChunks进行模块划分
    默认配置只会对异步请求的模块进行提取拆分，如果要对entry进行拆分，需要设置optimization.splitChunks.chunks = &apos;all&apos;
    会分离出单独的文件
</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">        splitChunks: &#123;</span><br><span class="line">            chunks: <span class="string">'all'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<pre><code>- 动态导入  通过模块内的函数调用
</code></pre><ol start="7">
<li><p>缓存 (体现文件是否改变)</p>
<ul>
<li><p>文件名</p>
<p>  通过使用 output.filename 进行文件名替换，可以确保浏览器获取到修改后的文件。[hash] 替换可以用于在文件名中包含一个构建相关(build-specific)的 hash，但是更好的方式是使用 [chunkhash] 替换，在文件名中包含一个 chunk 相关(chunk-specific)的哈希。</p>
</li>
<li><p>提取模板</p>
</li>
</ul>
</li>
<li><p>创建library</p>
<p> 创建自己的库</p>
</li>
</ol>
<h2 id="升级-4-遇到的问题"><a href="#升级-4-遇到的问题" class="headerlink" title="升级 @4 遇到的问题"></a>升级 @4 遇到的问题</h2><ol>
<li>依赖安装失败</li>
</ol>
<blockquote>
<p><a href="mailto:node@8.9.2" target="_blank" rel="noopener">node@8.9.2</a></p>
</blockquote>
<pre><code>webpack-cli@2.0.10 失败 2.0.09 ok

解决(暂) 先删除此依赖项, 安装其他, 最后单独安装

升级node 和 git后，安装成功 2333
</code></pre><ol start="2">
<li><p>bundle文件加载失败</p>
<p> bundle-loader可用但没啥道理</p>
</li>
<li><p>api变更</p>
<p> gulp升级到4 语法变更</p>
</li>
<li><p>jq图片裁剪上传插件出错。。。</p>
<p> 回滚webpack。。。。。求心里阴影面积</p>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com2018/03/16/2018-3-16/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="高宽">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高宽的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="2018/03/16/2018-3-16/" class="post-title-link" itemprop="url">travis实现自动部署git项目到私有云服务器</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-03-16 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-16T00:00:00+00:00">2018-03-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-15 11:33:59" itemprop="dateModified" datetime="2019-01-15T11:33:59+00:00">2019-01-15</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>自己有一个阿里云的虚拟服务器，用来部署自己闲暇所写练习。之前没有了解到自动化部署方案，每次更新需要登录服务器来更新文件，实在麻烦。偶然看到可以<a href="https://juejin.im/entry/5a7d77bcf265da4e8c44fdb6" target="_blank" rel="noopener">自动化部署</a>，所以有如下一番折腾。</p>
<img src="/2018/03/16/2018-3-16/travis20180315_1.jpg" width="1513">
<h2 id="原理图"><a href="#原理图" class="headerlink" title="原理图"></a>原理图</h2><img src="/2018/03/16/2018-3-16/travis20180315_2.jpg" width="562">
<h2 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h2><p>实现较为个人，服务器直接使用root账户</p>
<p>vue静态项目，只需要部署编译后的文件即可</p>
<p>如需做服务器用户区分等，可查看相关文章，底部链接中即有</p>
<h2 id="主要步骤："><a href="#主要步骤：" class="headerlink" title="主要步骤："></a>主要步骤：</h2><ol>
<li><p>创建github公开项目</p>
</li>
<li><p>服务器实现手动部署能力</p>
</li>
<li><p>登录travis，开启项目监听</p>
</li>
<li><p>服务器安装travis客户端等</p>
</li>
<li><p>处理rsa秘钥，并加入项目托管</p>
</li>
<li><p>测试</p>
</li>
</ol>
<h2 id="详细流程："><a href="#详细流程：" class="headerlink" title="详细流程："></a>详细流程：</h2><h3 id="1-创建github公开项目"><a href="#1-创建github公开项目" class="headerlink" title="1. 创建github公开项目"></a>1. 创建github公开项目</h3><p>没啥注意的，跑通项目就行了</p>
<h3 id="2-服务器实现手动部署能力"><a href="#2-服务器实现手动部署能力" class="headerlink" title="2. 服务器实现手动部署能力"></a>2. 服务器实现手动部署能力</h3><p>安装相关环境：git，node等相关依赖</p>
<p>实现：git更新项目、node构建、<a href="https://github.com/roy-k/roy-k.github.io/issues/4" target="_blank" rel="noopener">nginx服务</a>等，实现线上访问</p>
<p><a href="https://www.google.com/search?newwindow=1&amp;safe=strict&amp;ei=YYarWv67HMSw0gTzoILwCQ&amp;q=git-ssh" target="_blank" rel="noopener">git-ssh配置和使用</a></p>
<p>进入秘钥文件夹</p>
<pre><code>cd .ssh/
</code></pre><p>将生成的公钥添加为受信列表(<strong>travis访问服务器的关键</strong>)</p>
<pre><code>cat id_rsa.pub &gt;&gt; authorized_keys
</code></pre><p>测试访问，创建config文件，内容见下</p>
<blockquote>
<p>假如使用非root用户，需注意<a href="https://juejin.im/post/5a9e1a5751882555712bd8e1" target="_blank" rel="noopener">权限相关</a></p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Host test</span><br><span class="line">HostName <span class="number">99.99</span><span class="number">.99</span><span class="number">.99</span>(你的服务器ip)</span><br><span class="line">#登陆的用户名</span><br><span class="line">User travis</span><br><span class="line">IdentitiesOnly yes</span><br><span class="line">#登陆使用的密钥</span><br><span class="line">IdentityFile ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>
<pre><code>ssh test
</code></pre><h3 id="3-登录travis，开启项目监听"><a href="#3-登录travis，开启项目监听" class="headerlink" title="3. 登录travis，开启项目监听"></a>3. 登录travis，开启项目监听</h3><p>使用github账户，登录<a href="https://travis-ci.org" target="_blank" rel="noopener">travis</a></p>
<p>开启项目监听</p>
<img src="/2018/03/16/2018-3-16/travis20180315_3.jpg" width="381">
<p>进入项目日志页，先保留页面</p>
<h3 id="4-服务器安装travis客户端等"><a href="#4-服务器安装travis客户端等" class="headerlink" title="4. 服务器安装travis客户端等"></a>4. 服务器安装travis客户端等</h3><p>需先安装 ruby2.0</p>
<pre><code>yum install ruby

验证： ruby -v 或 gem -v
</code></pre><p>通过gem安装travis</p>
<pre><code>gem install travis

可能会安装失败 提示缺少ruby头文件，**yum install ruby-devel**可解决
</code></pre><p>登录travis, 使用github账户</p>
<pre><code>travis login
</code></pre><h3 id="5-处理rsa秘钥，并加入项目托管"><a href="#5-处理rsa秘钥，并加入项目托管" class="headerlink" title="5. 处理rsa秘钥，并加入项目托管"></a>5. 处理rsa秘钥，并加入项目托管</h3><p>进入项目目录，创建.travis.yml文件，填写项目基本配置，例：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">language: node_js</span><br><span class="line">node_js:</span><br><span class="line">- <span class="string">'8.9.0'</span></span><br></pre></td></tr></table></figure></p>
<p>加密本地秘钥, 会自动写入<em>.travis.yml</em>文件</p>
<pre><code>travis encrypt-file ~/.ssh/id_rsa --add
</code></pre><p>编辑<em>.travis.yml</em>文件</p>
<pre><code>删除最后一行的转义符(\)
</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">before_install:</span><br><span class="line">    - openssl aes<span class="number">-256</span>-cbc -K $encrypted_e65149523857_key -iv $encrypted_e65149523857_iv</span><br><span class="line">    -<span class="keyword">in</span> id_rsa.enc -out ~\/.ssh/id_rsa -d</span><br></pre></td></tr></table></figure>
<p>添加after_success钩子(<strong>部署关键</strong>)</p>
<pre><code>原理是使用ssh连接服务器，执行部署命令
</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">after_success:</span><br><span class="line">    - ssh root@xx.xx.xx.xx -o StrictHostKeyChecking=no <span class="string">'cd 项目目录 &amp;&amp; git pull &amp;&amp; npm install &amp;&amp; npm run build'</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用 ssh 命令连接一定要设置StrictHostKeyChecking=no，否则第一次连接时依然会要求你确认。后面引号的内容就是登陆你的Linux服务器之后，在你的服务器执行的命令，你也可以写成一个脚本。只要登陆上服务器之后，就随你操作了。</p>
</blockquote>
<p>提交上述更改至github</p>
<h3 id="6-测试"><a href="#6-测试" class="headerlink" title="6. 测试"></a>6. 测试</h3><p>更新、编辑、提交</p>
<p>刷新查看第3步保留的项目日志页，可跟踪执行状态</p>
<img src="/2018/03/16/2018-3-16/travis20180315_4.jpg" width="840">
<h2 id="异常点"><a href="#异常点" class="headerlink" title="异常点"></a>异常点</h2><pre><code>- yarn-lock文件有影响自动测试，删除后ok，使用npm，故未做深究。

- 服务器有开放StrictHostKeyChecking，还是需在ssh命令禁止验证，未知
</code></pre><h2 id="未达成"><a href="#未达成" class="headerlink" title="未达成"></a>未达成</h2><pre><code>- 集成测试相关配置(travis 配置)
</code></pre><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ul>
<li><a href="https://juejin.im/entry/5a7d77bcf265da4e8c44fdb6" target="_blank" rel="noopener">不仅仅是前端er——折腾服务器武装自己</a></li>
<li><a href="https://juejin.im/post/5a9e1a5751882555712bd8e1" target="_blank" rel="noopener">Travis-CI自动化测试并部署至自己的CentOS服务器</a></li>
<li><a href="http://bbs.bugcode.cn/t/5665" target="_blank" rel="noopener">gem install：无法构建gem原生扩展（无法找到头文件）</a><br><a href="https://www.cnblogs.com/ilinuxer/p/5087452.html" target="_blank" rel="noopener">linux ssh_config和sshd_config配置文件</a></li>
<li><a href="http://smilejay.com/2012/12/ssh-config-host-key-checking/" target="_blank" rel="noopener">SSH连接时提示“THE AUTHENTICITY OF HOST XX CAN’T BE ESTABLISHED”</a></li>
<li>等等</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com2018/02/27/2018-2-27/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="高宽">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高宽的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="2018/02/27/2018-2-27/" class="post-title-link" itemprop="url">在 Google platform 上架設 ShadowSocks(SS) + BBR</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-02-27 00:00:00" itemprop="dateCreated datePublished" datetime="2018-02-27T00:00:00+00:00">2018-02-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-15 11:33:59" itemprop="dateModified" datetime="2019-01-15T11:33:59+00:00">2019-01-15</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="建立-VPS"><a href="#建立-VPS" class="headerlink" title="建立 VPS"></a>建立 VPS</h2><blockquote>
<p>Google cloud platform 有免費 12 個月 300USD 的額度可以使用</p>
</blockquote>
<pre><code>- 註冊 [Google Clund Platform](https://cloud.google.com/) 服務

- 产品和服务(左上) -&gt; compute engine -&gt; VM实例 -&gt; 创建

- 选项:

    名稱：自定義，這是你的機器名稱
    區域：請選 asia-east1-c 或是 asia-northeast1-b (亞洲區)
    機器類型：由於做個人翻牆工具，可以只選「微型」就好，規格選越高錢扣越快
    開機磁碟：請選作業系統 Ubuntu 14.04 LTS
    防火牆：將「允許 HTTP 流量」和「允許 HTTPS 流量」皆設為開啟

- 用浏览器打开 SSH 链接, 执行下面指令
</code></pre><h2 id="安装服务"><a href="#安装服务" class="headerlink" title="安装服务"></a>安装服务</h2><pre><code>1. 先安裝 BBR 加速

&gt; BBR 是 Google 官方開源的擁塞算法來加速 TCP

    - 依序輸入
    wget –no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh

    chmod +x bbr.sh

    sudo ./bbr.sh

    輸入任意鍵執行

    如询问是否重启, 输入y重启 (我这里没提示重启)

    輸入 sudo sysctl net.ipv4.tcp_available_congestion_control

    如果有出現 bbr 字眼，就是安裝成功了

1. 安裝 ShadowSocks(SS)

    sudo apt-get install python-pip -y

    sudo pip install shadowsocks

    重要！！！ 以下指令中的 password 請務必改成自己要使用的

    sudo ssserver -p 443 -k password -m aes-256-cfb --user nobody -d start

    **我这里这里执行出错, 查询为&quot;openssl库更新导致名称变更的问题&quot;**
</code></pre><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">File <span class="string">"/usr/local/bin/ssserver"</span>, line <span class="number">11</span>, in &lt;<span class="keyword">module</span>&gt;</span><br><span class="line">    sys.<span class="built_in">exit</span>(main())</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/shadowsocks/server.py"</span>, line <span class="number">34</span>, in main</span><br><span class="line">    config = shell.get_config(False)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/shadowsocks/shell.py"</span>, line <span class="number">262</span>, in get_config</span><br><span class="line">    check_config(config, is_local)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/shadowsocks/shell.py"</span>, line <span class="number">124</span>, in check_config</span><br><span class="line">    encrypt.try_cipher(config['password'], config['method'])</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/shadowsocks/encrypt.py"</span>, line <span class="number">44</span>, in try_cipher</span><br><span class="line">    Encryptor(key, method)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/shadowsocks/encrypt.py"</span>, line <span class="number">83</span>, in __init__</span><br><span class="line">    random_string(self._method_info[<span class="number">1</span>]))</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/shadowsocks/encrypt.py"</span>, line <span class="number">109</span>, in get_cipher</span><br><span class="line">    <span class="keyword">return</span> m[<span class="number">2</span>](method, key, iv, op)</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/shadowsocks/crypto/openssl.py"</span>, line <span class="number">76</span>, in __init__</span><br><span class="line">    load_openssl()</span><br><span class="line">  File <span class="string">"/usr/local/lib/python2.7/dist-packages/shadowsocks/crypto/openssl.py"</span>, line <span class="number">52</span>, in load_openssl</span><br><span class="line">    libcrypto.EVP_CIPHER_CTX_cleanup.argtypes = (c_void_p,)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/ctypes/__init__.py"</span>, line <span class="number">375</span>, in __getattr__</span><br><span class="line">    func = self.__getitem__(name)</span><br><span class="line">  File <span class="string">"/usr/lib/python2.7/ctypes/__init__.py"</span>, line <span class="number">380</span>, in __getitem__</span><br><span class="line">    func = self._FuncPtr((name_or_ordinal, self))</span><br><span class="line">AttributeError: /usr/lib/x86_64-linux-gnu/libcrypto.so<span class="number">.1</span><span class="number">.1</span>: undefined symbol: EVP_CIPHER_CTX_cleanup</span><br></pre></td></tr></table></figure>
<pre><code>    需使用sudo vim 编辑并保存

    /usr/local/lib/python2.7/dist-packages/shadowsocks/crypto/openssl.py 将此文件中的52行和111行中的cleanup更新为reset后，再尝试启动

    將服務停止

    sudo ssserver -d stop

    再次運行

    sudo ssserver -p 443 -k password -m aes-256-cfb --user nobody -d start

    大功告成，你已經有一台 SS + BBR 來做翻牆的機器了!

3. 機器詳細資訊

    - IP 位置是你架設機器在上面寫的「外部 IP」
    - 密碼是剛剛你自行替換的「password」
    - 加密規則是 aes-256-cfb
    - port 通道 443

4. 在终端(手机/电脑/..)安装翻墙工具并配置 (ShadowSocks)
</code></pre><p>参考:</p>
<p><a href="http://blog.niclin.tw/posts/2159790-wall-on-the-google-platform-set-up-shadowsocks-ss-bbr" target="_blank" rel="noopener">[翻牆] 在 Google platform 上架設 ShadowSocks(SS) + BBR</a><br><a href="https://github.com/shadowsocks/shadowsocks/issues/946" target="_blank" rel="noopener">树莓派安装客户端后运行出错</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com2017/12/07/2017-12-7/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="高宽">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="高宽的小站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="2017/12/07/2017-12-7/" class="post-title-link" itemprop="url">Nginx 常用配置</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-12-07 00:00:00" itemprop="dateCreated datePublished" datetime="2017-12-07T00:00:00+00:00">2017-12-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-01-15 11:33:59" itemprop="dateModified" datetime="2019-01-15T11:33:59+00:00">2019-01-15</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="几个命令"><a href="#几个命令" class="headerlink" title="几个命令"></a>几个命令</h2><pre><code>- -?, -h        帮助
- -v, -V        版本
- -t, -T        测试配置
- -q            测试配置时只显示错误
- -s            向主进程命令: stop, quit, reopen, reload
- -p            指定nginx服务器路径前缀
- -c            指定配置文件
- -g            指定nginx附加配置文件路径
</code></pre><h2 id="配置-nginx-conf"><a href="#配置-nginx-conf" class="headerlink" title="配置 (nginx.conf)"></a>配置 (nginx.conf)</h2><h3 id="1-全局块"><a href="#1-全局块" class="headerlink" title="1. 全局块"></a>1. 全局块</h3><p>配置运行参数: 运行nginx服务器的用户(组), 允许的进程数, 进程PID存放路径, 日志路径和类型, 配置文件引入等…</p>
<h3 id="2-events-块"><a href="#2-events-块" class="headerlink" title="2. events 块"></a>2. events 块</h3><p>配置与用户的连接: 多进程连接的序列化, 是否允许同时接收多个连接, 事件驱动模型, 每个进程的最大连接数…</p>
<h3 id="3-http-块"><a href="#3-http-块" class="headerlink" title="3. http 块"></a>3. http 块</h3><p>配置服务器功能: servers, 文件引入, MIME-Type, 日志, 是否使用sendfile传输文件, 连接超时, 单连接请求数上限…</p>
<h3 id="4-sever-块"><a href="#4-sever-块" class="headerlink" title="4. sever 块"></a>4. sever 块</h3><p>虚拟主机: locations, 监听配置, 主机名, ip配置</p>
<h3 id="5-location-块"><a href="#5-location-块" class="headerlink" title="5. location 块"></a>5. location 块</h3><p>路由匹配: 地址定向, 数据缓存, 应答控制</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#user  user group;                  # 指定用户(组)可用 linux</span></span><br><span class="line">worker_processes  <span class="number">1</span>;                # 允许进程数</span><br><span class="line"><span class="meta">#pid        logs/nginx.pid;         # 进程PID 存放地址</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> file;</span></span><br><span class="line"></span><br><span class="line">#error_log  logs/error.<span class="built_in">log</span>;         # 系统运行错误日志及日志级别</span><br><span class="line">#error_log  logs/error.<span class="built_in">log</span>  notice;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    # accept_mutex on;              # 默认开启, 防止多个进程对链接的争抢</span><br><span class="line">    # multi_accept off;             # 默认关闭, 进程同时接收多个请求</span><br><span class="line">    <span class="meta"># use method;                   # 事件驱动模型: select, poll, kqueue, epoll...</span></span><br><span class="line">    worker_connections  <span class="number">1024</span>;       # 每个进程的最大连接数</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;                   # 资源类型</span><br><span class="line">    default_type  application/octet-stream;     # 字节流</span><br><span class="line"></span><br><span class="line">    # 服务日志 remote_addr请求ip,</span><br><span class="line">    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span><br><span class="line">    #                  '$status $body_bytes_sent "$http_referer" '</span><br><span class="line">    #                  '"$http_user_agent" "$http_x_forwarded_for"';</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.<span class="built_in">log</span>  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;                             # 允许sendfile方式传输文件</span><br><span class="line">    keepalive_timeout  <span class="number">65</span>;                          # 链接超时 [keep-alive域的超时时间]</span><br><span class="line">    # tcp_nopush = on 会设置调用tcp_cork方法. 数据包不会马上传送出去，等到数据包最大时，一次性的传输出去，这样有助于解决网络堵塞。</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line">    #keepalive_requests number;                     # 限制用户通过单一链接请求次数</span><br><span class="line"></span><br><span class="line">    <span class="meta">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">    upstream svrs &#123;                                 # 代理服务器组</span><br><span class="line">        server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">3080</span>;</span><br><span class="line">        server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">3081</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       <span class="number">80</span>;                            # 配置网络监听</span><br><span class="line">        <span class="meta">#listen      *:80;                          # 同 80</span></span><br><span class="line">        <span class="meta">#listen      192.168.1.10;                  # 监听具体ip 所有端口的连接</span></span><br><span class="line">        <span class="meta">#listen      80 default_server backlog=1024;# 设置端口为80的所有连接, 默认此虚拟主机, 允许最多1024个连接同时处于挂起状态</span></span><br><span class="line"></span><br><span class="line">        server_name  localhost;                     # 约同域名, 配置好dns即可由此访问虚拟主机</span><br><span class="line"></span><br><span class="line">        <span class="meta">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.<span class="built_in">log</span>  main;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#location [ = | ~ | ~* | ^~] uri &#123;&#125;         # 标识符匹配</span></span><br><span class="line"></span><br><span class="line">        location /tjs &#123;</span><br><span class="line">            <span class="meta"># root E:\\;                            # 配置根目录, 保留路径</span></span><br><span class="line">            <span class="meta"># alias E:\\test;                       # 更改uri, 替换路径, 即 /tjs/ -&gt; /test/</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /tjs1 &#123;</span><br><span class="line">            proxy_pass http:<span class="comment">//svrs;                 # 转发(加上路径: tjs)</span></span><br><span class="line">            # proxy_pass http:<span class="comment">//svrs/aa;            # 如果配置转发路径(/也算), 会替换匹配路径(tjs)</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /tjs2/ &#123;</span><br><span class="line">            # proxy_pass http:<span class="comment">//svrs/;              # 这样就可以除去路径, 即 /tjs2/svrs -&gt; /svrs</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /others &#123;</span><br><span class="line">            <span class="meta">#root path;</span></span><br><span class="line">            <span class="meta">#index file;                            # 默认首页, 可以根据不同路径, 展示不同首页</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        #error_page  <span class="number">404</span>              /<span class="number">404.</span>html;    # 错误码 对应的错误页面</span><br><span class="line"></span><br><span class="line">        <span class="meta"># redirect server <span class="meta-keyword">error</span> pages to the static page /50x.html</span></span><br><span class="line">        error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /<span class="number">50</span>x.html;</span><br><span class="line">        location = /<span class="number">50</span>x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class="line">        #</span><br><span class="line">        <span class="meta">#location ~ \.php$ &#123;</span></span><br><span class="line">        #    proxy_pass   http:<span class="comment">//127.0.0.1;</span></span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line">        #</span><br><span class="line">        <span class="meta">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="meta">#    root           html;</span></span><br><span class="line">        #    fastcgi_pass   <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">9000</span>;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        <span class="meta">#    <span class="meta-keyword">include</span>        fastcgi_params;</span></span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache's document root</span><br><span class="line">        # concurs with nginx's one</span><br><span class="line">        #</span><br><span class="line">        <span class="meta">#location ~ /\.ht &#123;</span></span><br><span class="line">        <span class="meta">#    deny  all;</span></span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">    <span class="meta">#    listen       somename:8080;</span></span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.<span class="built_in">log</span>  main;</span><br><span class="line"></span><br><span class="line">        location /api &#123;</span><br><span class="line">             proxy_pass http:<span class="comment">//api;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    <span class="meta">#server &#123;</span></span><br><span class="line">    <span class="meta">#    listen       443 ssl;</span></span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">    #    ssl_session_cache    shared:SSL:<span class="number">1</span>m;</span><br><span class="line">    #    ssl_session_timeout  <span class="number">5</span>m;</span><br><span class="line"></span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#    location / &#123;</span></span><br><span class="line">    <span class="meta">#        root   html;</span></span><br><span class="line">    <span class="meta">#        index  index.html index.htm;</span></span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Nginx-代理服务"><a href="#Nginx-代理服务" class="headerlink" title="Nginx 代理服务"></a>Nginx 代理服务</h2><h3 id="1-正向代理-用代理访问外网"><a href="#1-正向代理-用代理访问外网" class="headerlink" title="1. 正向代理: 用代理访问外网"></a>1. 正向代理: 用代理访问外网</h3><h3 id="2-反向代理-开放给外部访问"><a href="#2-反向代理-开放给外部访问" class="headerlink" title="2. 反向代理: 开放给外部访问"></a>2. 反向代理: 开放给外部访问</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">upstream proxy_svrs &#123;</span><br><span class="line">    server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">3080</span>;</span><br><span class="line">    server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">3081</span> weight=<span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    location /ttjs &#123;</span><br><span class="line">        proxy_pass http:<span class="comment">//proxy_svrs;       # 此处声明协议, upstream处就省去</span></span><br><span class="line">        # 其他命令</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>proxy_pass                    设置转发目标</li>
<li>proxy_hide_header             隐藏一些头域信息</li>
<li>proxy_pass_header             添加部分报文头</li>
<li>proxy_pass_request_body       设置是否转发请求体 默认on</li>
<li>proxy_pass_request_headers    设置是否转发请求头 默认on</li>
<li>proxy_set_header              更改..头</li>
<li>proxy_set_body                更改..体</li>
<li>proxy_bind</li>
<li>proxy_connect_timeout         连接目标服务器超时</li>
<li>proxy_read_timeout</li>
<li>proxy_send_timeout</li>
<li>proxy_http_version</li>
<li>proxy_method                  转发所用方法</li>
<li>proxy_ignore_client_abort     客户端中断时是否立即中断 默认on, 即中断</li>
<li>proxy_ignore_headers</li>
<li>proxy_redirect                设置响应头域</li>
<li>proxy_intercept_errors</li>
<li>proxy_headers_hash_max_size</li>
<li>proxy_headers_hash_bucket_size</li>
<li>proxy_next_upstream</li>
<li>proxy_ssl_session_reuse</li>
</ul>
<h2 id="配置优化"><a href="#配置优化" class="headerlink" title="配置优化"></a>配置优化</h2><p><a href="http://www.7rack.info/Nginx-Config-Pitfalls.html" target="_blank" rel="noopener">Nginx 配置陷阱和常见错误</a></p>
<ol>
<li>root / index 提出</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    server_name www.example.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /var/www/nginx-<span class="keyword">default</span>/;</span><br><span class="line">        index index.php index.htm index.html;</span><br><span class="line">      &#125;</span><br><span class="line">    location /foo &#123;</span><br><span class="line">        root /var/www/nginx-<span class="keyword">default</span>/;</span><br><span class="line">        index index.php index.htm index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"># --&gt;</span><br><span class="line"></span><br><span class="line">index index.php index.htm index.html;   <span class="meta"># http块中 将会被继承</span></span><br><span class="line">server &#123;</span><br><span class="line">    server_name www.example.com;</span><br><span class="line">    root /var/www/nginx-<span class="keyword">default</span>/;       # 避免每个location都配一遍</span><br><span class="line">    location / &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    location /foo &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>不使用 Hostname 去解析地址</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">upstream &#123;</span><br><span class="line">    server http:<span class="comment">//someserver;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen myhostname:<span class="number">80</span>;</span><br><span class="line">    # [...]</span><br><span class="line">&#125;</span><br><span class="line"># 在服务启动或者重启时 hostname 不能解析。这会引起 NGINX 无法绑定到特定的 TCP 端口而启动失败。</span><br><span class="line">upstream &#123;</span><br><span class="line">    server http:<span class="comment">//10.48.41.12;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">127.0</span><span class="number">.0</span><span class="number">.16</span>:<span class="number">80</span>;</span><br><span class="line">    # [...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>…</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="page/2/">2</a><a class="extend next" rel="next" href="page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">高宽</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">高宽</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.7.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="js/src/utils.js?v=6.7.0"></script>

  <script src="js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="js/src/schemes/muse.js?v=6.7.0"></script>



  

  


  <script src="js/src/bootstrap.js?v=6.7.0"></script>



  



  





  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
