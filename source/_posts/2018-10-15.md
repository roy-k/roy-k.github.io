---
title: graphql 入门
date: 2018-10-15
tags: [graphql]
categories: []
---
[graphql](http://graphql.cn/graphql-js/)是一种用于 API 的查询语言, 可以实现请求侧控制响应内容/请求合并等特性, 并且使用 schema 来定义数据, 可以实现定义即文档. 方便前后端协作

> 基础语法及用法, 官方文档介绍的足够详细, 不再赘述, 下面只介绍一些我在项目中的用法, 仅供参考

## 1. query 语句的管理

- 使用*片段* *变量* 等特性, 来实现请求数据的复用和参数传递, 便于封装接口

- 复用片段会导致难以控制响应内容, 部分接口可能会请求到多余的数据

<!-- more -->
```js
// ********* Fragments **************************//
// 项目详情
const frgProjectFields = `
    fragment frgProjectFields on ProjectInfo {
        name
        id
        sendArea
        downArea
        validityTime
        validityUnit
        sendBucket
        downBucket
        totalFileCount
        totalFileSize
        createTime
    }`

// 文件下载链接信息
const frgFileUrlInfo = `
fragment frgFileUrlInfo on FileUrlInfo {
    shareId
    downUrl
    code
    expiresTime
    createAt
}`

// 文件访问记录信息
const frgFileLogCount = `
fragment frgFileLogCount on fileLogCount {
    downCount
    viewCount
}`

// 文件详情
const frgFileInfo = `
fragment frgFileInfo on FileInfo {
    id
    fileName
    originalName
    fileSize
    createAt
    updateAt
    state
    syncInfo
    sendFileUrlInfo {...frgFileUrlInfo}
    downFileUrlInfo {...frgFileUrlInfo}
    fileLogCount {...frgFileLogCount}
}
${frgFileUrlInfo}
${frgFileLogCount}
`

// ********* Fragments End **************************//

// ********* query **************************//

// ** 项目 **
// 查询项目列表
const queryGetProjectList = `query queryProject($id: ID) {
    queryProject (id:$id){ # 查询项目
        ...frgProjectFields
    }
  }
  ${frgProjectFields}
`
```


## 2. 接口封装

> 其中 http 是封装的请求库, 基于 [graphql-request](https://www.npmjs.com/package/graphql-request), 封装了loading的控制, 重试机制, 以及错误处理

```js
import http from "../common/js/http"

import {
    queryGetProjectList,
} from "./querySchema"

/**
 * 查询项目列表
 * @param {sting} id    - 项目id
 */
const getProjectList = (id = "") => {
    return http.requestRetry(queryGetProjectList, { id })
}
```