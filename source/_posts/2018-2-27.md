---
title: 在 Google platform 上架設 ShadowSocks(SS) + BBR
date: 2018-02-27
tags: [ssr]
categories: [其他]
---
## 建立 VPS

> Google cloud platform 有免費 12 個月 300USD 的額度可以使用

    - 註冊 [Google Clund Platform](https://cloud.google.com/) 服務

    - 产品和服务(左上) -> compute engine -> VM实例 -> 创建

    - 选项:

        名稱：自定義，這是你的機器名稱
        區域：請選 asia-east1-c 或是 asia-northeast1-b (亞洲區)
        機器類型：由於做個人翻牆工具，可以只選「微型」就好，規格選越高錢扣越快
        開機磁碟：請選作業系統 Ubuntu 14.04 LTS
        防火牆：將「允許 HTTP 流量」和「允許 HTTPS 流量」皆設為開啟

    - 用浏览器打开 SSH 链接, 执行下面指令

<!-- more -->
## 安装服务

    1. 先安裝 BBR 加速

    > BBR 是 Google 官方開源的擁塞算法來加速 TCP

        - 依序輸入
        wget –no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh

        chmod +x bbr.sh

        sudo ./bbr.sh

        輸入任意鍵執行

        如询问是否重启, 输入y重启 (我这里没提示重启)

        輸入 sudo sysctl net.ipv4.tcp_available_congestion_control

        如果有出現 bbr 字眼，就是安裝成功了

    1. 安裝 ShadowSocks(SS)

        sudo apt-get install python-pip -y

        sudo pip install shadowsocks

        重要！！！ 以下指令中的 password 請務必改成自己要使用的

        sudo ssserver -p 443 -k password -m aes-256-cfb --user nobody -d start

        **我这里这里执行出错, 查询为"openssl库更新导致名称变更的问题"**
```C
File "/usr/local/bin/ssserver", line 11, in <module>
    sys.exit(main())
  File "/usr/local/lib/python2.7/dist-packages/shadowsocks/server.py", line 34, in main
    config = shell.get_config(False)
  File "/usr/local/lib/python2.7/dist-packages/shadowsocks/shell.py", line 262, in get_config
    check_config(config, is_local)
  File "/usr/local/lib/python2.7/dist-packages/shadowsocks/shell.py", line 124, in check_config
    encrypt.try_cipher(config['password'], config['method'])
  File "/usr/local/lib/python2.7/dist-packages/shadowsocks/encrypt.py", line 44, in try_cipher
    Encryptor(key, method)
  File "/usr/local/lib/python2.7/dist-packages/shadowsocks/encrypt.py", line 83, in __init__
    random_string(self._method_info[1]))
  File "/usr/local/lib/python2.7/dist-packages/shadowsocks/encrypt.py", line 109, in get_cipher
    return m[2](method, key, iv, op)
  File "/usr/local/lib/python2.7/dist-packages/shadowsocks/crypto/openssl.py", line 76, in __init__
    load_openssl()
  File "/usr/local/lib/python2.7/dist-packages/shadowsocks/crypto/openssl.py", line 52, in load_openssl
    libcrypto.EVP_CIPHER_CTX_cleanup.argtypes = (c_void_p,)
  File "/usr/lib/python2.7/ctypes/__init__.py", line 375, in __getattr__
    func = self.__getitem__(name)
  File "/usr/lib/python2.7/ctypes/__init__.py", line 380, in __getitem__
    func = self._FuncPtr((name_or_ordinal, self))
AttributeError: /usr/lib/x86_64-linux-gnu/libcrypto.so.1.1: undefined symbol: EVP_CIPHER_CTX_cleanup

```
        需使用sudo vim 编辑并保存

        /usr/local/lib/python2.7/dist-packages/shadowsocks/crypto/openssl.py 将此文件中的52行和111行中的cleanup更新为reset后，再尝试启动

        將服務停止

        sudo ssserver -d stop

        再次運行

        sudo ssserver -p 443 -k password -m aes-256-cfb --user nobody -d start

        大功告成，你已經有一台 SS + BBR 來做翻牆的機器了!

    3. 機器詳細資訊

        - IP 位置是你架設機器在上面寫的「外部 IP」
        - 密碼是剛剛你自行替換的「password」
        - 加密規則是 aes-256-cfb
        - port 通道 443

    4. 在终端(手机/电脑/..)安装翻墙工具并配置 (ShadowSocks)

参考:

[[翻牆] 在 Google platform 上架設 ShadowSocks(SS) + BBR](http://blog.niclin.tw/posts/2159790-wall-on-the-google-platform-set-up-shadowsocks-ss-bbr)
[树莓派安装客户端后运行出错](https://github.com/shadowsocks/shadowsocks/issues/946)