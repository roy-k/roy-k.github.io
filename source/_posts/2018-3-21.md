---
title: webpack 入门姿势
date: 2018-03-21
tags:
---

## 演变过程

1. 输入输出

    - 管理资源:  各种loader
    - 组织输出:
        - html-webpack-plugin  更新引用
        - clean-webpack-plugin  清理dist文件夹
        - 多出口名称格式化  [name].bundle.js

2. 助力开发

    - source map

        开发环境推荐：  cheap-module-eval-source-map
        生产环境推荐：  cheap-module-source-map

    - 查看更新

        webpack's Watch Mode        观察模式, 需要刷新浏览器

        webpack-dev-server  可以自动打开浏览器 / 热替换 / 自动刷新

        webpack-dev-middleware      一个容器(wrapper)，它可以把 webpack 处理后的文件传递给一个服务器(server)


3. 模块热替换(只编译并替换变更的部分)

    - 命令后加 --hot

    - 配置中启用热替换: dev-server: hot设为true, 并加入plugins
```javascript
plugins: [
    new webpack.HotModuleReplacementPlugin()
]
 ```

4. Tree Shaking   移除无用代码  (4+  已集成)

    uglifyjs-webpack-plugin 谨慎模式

5. 配置分离

取出公共配置, 通过webpack-merge或手动合并独立配置

6. 代码分离

    - 分离css

        ExtractTextPlugin 分离出单独的文件

    - 入口分离  使用 entry 手动分离

        会重复引用模块 / 不灵活 / 不能动态拆分


    - 防止重复  使用 commonsChunkPlugin 去重和分离chunk (4+ 已移除)

        改成使用optimization.splitChunks进行模块划分
        默认配置只会对异步请求的模块进行提取拆分，如果要对entry进行拆分，需要设置optimization.splitChunks.chunks = 'all'
        会分离出单独的文件

```javascript
optimization: {
        splitChunks: {
            chunks: 'all'
        }
    }
```

    - 动态导入  通过模块内的函数调用

7. 缓存 (体现文件是否改变)

    - 文件名

        通过使用 output.filename 进行文件名替换，可以确保浏览器获取到修改后的文件。[hash] 替换可以用于在文件名中包含一个构建相关(build-specific)的 hash，但是更好的方式是使用 [chunkhash] 替换，在文件名中包含一个 chunk 相关(chunk-specific)的哈希。

    - 提取模板

8. 创建library

    创建自己的库


## 升级 @4 遇到的问题

1. 依赖安装失败

> node@8.9.2

    webpack-cli@2.0.10 失败 2.0.09 ok

    解决(暂) 先删除此依赖项, 安装其他, 最后单独安装

    升级node 和 git后，安装成功 2333

2. bundle文件加载失败

    bundle-loader可用但没啥道理

3. api变更

    gulp升级到4 语法变更

4. jq图片裁剪上传插件出错。。。

    回滚webpack。。。。。求心里阴影面积


