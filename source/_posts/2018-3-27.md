---
title: switchHost + nginx 开发环境
date: 2018-03-27
tags: [nginx]
categories: [development]
---
我们团队一直使用switchHost + nginx来搭建web开发环境, 可以在开发是避开跨域问题, 以及保留登陆态等好处.

后来在此基础上, 我制定了端口及项目路径命名规范, 加入了api等转发配置, 实现了多个项目的集中配置, 和并行开发的能力.

<!-- more -->
## 要点

> 我们开发环境使用测试环境的接口和数据

1. switchHost 把测试环境的 host 切到本地
2. nginx 转发本地路径到开发端口
3. nginx 转发 api 到服务器

## 代码说明

**1. webpack-dev-server 配置**

> webpack.config.dev.js
```js
output: {
        publicPath: '/asset/',
        // ...
    },
    devServer: {
        "disableHostCheck": true,
        host: 'localhost',
        port: 3010,
        // 和上文output的"publicPath"值保持一致
        publicPath: '/asset/',
        // ...
    },
    // ...
```

**2. [switchHost](https://oldj.github.io/SwitchHosts/)**

{% asset_img switchHost.png %}


**3. nginx 配置**

```shell
server {
    listen 80;
    server_name localhost;

# 开发环境页面转发,
    location /transfer {
        proxy_pass http://127.0.0.1:3010;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /plot {
        proxy_pass http://127.0.0.1:3020;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

# api 相关转发, 对应项目的接口路径
    location /api/transfer {
        proxy_pass http://10.222.145.185:443;
        proxy_set_header X-Real-IP $remote_addr;
        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Cookie $http_cookie;
    }

    location /api/plot {
        proxy_pass http://10.222.145.185:443;
        proxy_set_header X-Real-IP $remote_addr;
        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Cookie $http_cookie;
    }
}
```

## 使用说明

- 不同项目, 预先设置端口, 依据类型使用指定的命名规则
- 如有登录态等信息, 需测试环境先登录后, 再切换host到开发环境
- 跨协议时会有数据无法复用(比如测试环境是https), 需手动设置存储
- 测试环境页面缓存, 难以打开开发环境, 可在地址后添加查询字符串, 并多次刷新页面