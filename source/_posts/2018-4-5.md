---
title: node 事件池 - macro micro tick Task
date: 2018-04-05
tags:
---
# 核心概念

## js 引擎模型

从宏观角度讲, js 的执行是单线程的. 所有的异步结果都是通过 “任务队列(Task Queue)” 来调度被调度. 消息队列中存放的是一个个的任务(Task). 规范中规定, Task 分为两大类, 分别是 Macro Task 和 Micro Task.

> **每个 Macro Task 结束后, 都要清空所有的 Micro Task**

> **当这些 microtask 执行结束后还能继续添加 microtask 一直到真个 microtask 队列执行结束**

## Task 分类

1. Macrotask 包括:

    - setImmediate
    - setTimeout
    - setInterval
2. Microtask 包括:
    - process.nextTick
    - Promise
    - Object.observe
    - MutaionObserver

```javascript
setTimeout(function () {
    console.log(5);
    // 当这些 microtask 执行结束后还能继续添加 microtask 一直到真个 microtask 队列执行结束。
    process.nextTick(function() {
        console.log(7);
    })
    Promise.resolve().then(() => {
        console.log(8);
    })
    }, 0);
setImmediate(function() {
    console.log(6);
    });
new Promise(function (resolve) {
    console.log(1);
    resolve();
    console.log(2);
    }).then(function () {
    console.log(4);
    });
process.nextTick(function() {
    console.log(3);
    });
1
2
3
4
5
7
8
6
```

从微观实现的角度讲, 引擎都会有三个 Task Queue:

    - Tick Task Queue
    - Micro Task Queue
    - Macro Task Queue

> Tick 优先级高于 Micro
