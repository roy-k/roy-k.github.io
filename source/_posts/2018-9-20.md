---
title: 卡片动态计算间距
date: 2018-09-20
tags: []
categories: []
---
项目首页是卡片式的布局, 并且页面非定宽, 需动态排布. 查询flex等样式都无法满足, 所以使用js动态设置样式来实现.

## 页面示意

> 卡片宽度固定, 需随着页面宽度的变化, 来动态的改变一排所展示的卡片数量, 并且居中排布

{% asset_img projectCss.png %}

<!-- more -->
## 需求分析

由于要铺满并且居中, 卡片之间距离会变化.
首先定义好最大最小距离, 然后按优先级, 先计算最小间距下的数目, 然后把剩余空间平均分配就好

## 关键代码

```js
setCardMargin() {
        const w = this.homeBox.current.offsetWidth
        if (!w) return
        // 1. 卡片宽 210px
        // 2. 最小间距 20 * 2px
        // 3. 最大间距 40 * 2px
        // 1. 优先最小间距铺满

        //      如最小间距 比最大间距能多放一个, 就按最小间距
        //      不能的话, 计算间距
        const countWithMinGap = Math.floor(w / 250)
        const restWithMinGap = w % 250
        const averageGapBuff = restWithMinGap / countWithMinGap / 2
        const cardGap = Math.floor(20 + averageGapBuff)

        this.setState({ cardGap })
    }

    onWindowResize() {
        this.setCardMargin()
    }

    componentDidMount() {
        window.addEventListener("resize", this.onWindowResize)
        this.setCardMargin()
    }
```

## 特殊

滚动条会影响宽度采集, 这里使用css来规避跳动
```stylus
.home
    margin-right calc(100% - 100vw)
```