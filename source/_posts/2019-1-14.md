---
title: react 使用 mobx 实现无刷新切换语言
date: 2019-01-14 16:22:27
tags: [mobx]
categories: [react]
---
项目需要中英双语, 第一个版本通过加载页面时识别语言设置, 来加载对应语言数据. 切换语言时, 需要先设置语言, 然后重载页面. 后来引入 [mobx](https://cn.mobx.js.org/) 状态管理后, 利用响应式的思维, 实现了点击切换语言时, 自动的更新ui, 而无需刷新页面.

**要点与实现**
1. 创建可观察数据*语言*, 并实现相应*actions*
2. 在语言配置中引入上述语言配置, 并导出响应式结果(函数)
3. 组件使用mobx包装, 并使用上述语言配置

<!-- more -->
## 关键代码

1. 定义状态和动作

```js
class LanguageStore {
    @observable lang = 'ch'

    @action.bound setLang(lang = 'ch') {
        this.lang = lang
    }
}
```

2. 语言配置

```js

import { computed } from "mobx"

/**
 * 这里语言使用了 {英文: 中文} 的数据格式
*/
import langStore from '../../store/languageStore'

import HOME_LANG from './lang.home'

class Language {

    _getLangFunction(langOption) {
        return (key) => {
            return langStore.lang === 'ch' ? langOption[key] : key
        }
    }

    @computed get homeLang() {
        return this._getLangFunction(HOME_LANG)
    }
}

const ins = new Language()

const homeLang = ins.homeLang

// 方便导入 import {homeLang} from ...
export {
    homeLang,
}

export default ins
```

3. 组件内使用

```js
//...
import {homeLang} from "common/language"
@observer
class Home extends Component {
    // ...
    render() {
        return (
            <div>
                <div className="home">
                    <div className="title">
                        {homeLang("Title")}
                    </div>
                </div>
            </div>
        )
    }
}
```