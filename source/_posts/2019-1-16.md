---
title: travis 实现 github 博客自动部署
date: 2019-01-16 10:35:34
tags: [travis, CI]
---
之前一直在 github 的 issue 写总结, 但是路径太深, 查看时也不方便, 趁着有点时间, 就使用 hexo 重新搭建了一下. 折腾一下自动部署, 解决发布麻烦的问题

## 原理

利用 travis 监听 git 提交, 构建生成发布文件, 并推送至 blog 分支.

## 关键步骤

1. github 创建仓库, 并生成 Token

2. 使用 hexo 搭建本地博客源文件

3. travis 注册监听

4. travis 加密秘钥, 创建项目部署相关配置

## 命令及示意

1. travis 本地客户端安装, 用于加密 Github Personal Access Token

```shell
brew search travis
brew install travis

travis login --org  # 登陆公共账户, --pro 可以拉取私有仓库
travis encrypt -r roy-k/roy-k.github.io GH_TOKEN=xxxx  # xxxx 是 github 生成的 token
```

2. 项目 git 相关

> 主题通过 fork + subtree 形式加入管理

```shell
git remote add -f next https://github.com/roy-k/hexo-theme-next.git
git subtree add --prefix=themes/next next master --squash

git remote  https://github.com/roy-k/roy-k.github.io.git

git remote add origin https://github.com/roy-k/roy-k.github.io.git
git push -u origin master
```
> 这里开始没有想好, 因为我仓库直接取名 github.io, 所以不需要使用 gh-pages 分支来展示
> 修改为: 在 source 分支写作, 在 travis 编译后, 覆盖到 master 分支
> travis 也改为监听 source 分支

```shell
git checkout -b source
# ...
git push --set-upstream origin source
```

## 参考文章

[使用 Travis CI 自动更新 GitHub Pages](https://notes.iissnan.com/2016/publishing-github-pages-with-travis-ci/)
[Hexo主题同步](http://w4lle.com/2016/06/06/Hexo-themes/index.html)
[把github项目加入本地git库管理](https://blog.csdn.net/samxx8/article/details/72121494)
